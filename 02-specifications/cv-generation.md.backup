# G√©n√©ration CV (Prompt ‚Üí OpenAI ‚Üí React Component ‚Üí PDF)

## üéØ Innovation Principale : Prompt-Driven Generation

**Rupture avec approche formulaire classique** : l'utilisateur d√©crit son parcours en **langage naturel**, l'IA structure automatiquement.

### Approche v0 (Maquette fonctionnelle)
- Textarea libre pour description parcours
- Option "CV cibl√© pour un poste" avec description d'annonce
- Upload CV existant (OCR futur)
- Saisie vocale (Web Speech API)
- G√©n√©ration via Vercel AI SDK (`generateObject()`)

### Objectif Production SkillForge
Produire un **PDF haute qualit√©** via g√©n√©ration asynchrone c√¥t√© serveur.

## D√©cision Technique

### MVP (Simplifi√© pour 7 jours)
1. **LLM** (OpenAI) produit **JSON strict** (sch√©ma Zod/TypeScript)
2. **React Component** c√¥t√© serveur (react-pdf-renderer) pour g√©n√©rer PDF directement
3. **G√©n√©ration synchrone** dans API route Next.js (suffisant pour MVP)
4. **Fallback** : si timeout/erreur ‚Üí g√©n√©ration d√©mo offline

### v2 (Post-MVP)
- Worker async (BullMQ + Redis)
- Playwright pour HTML/CSS ‚Üí PDF haute qualit√©
- Support multi-templates avanc√©s

## Mod√®le de donn√©es (CVData)

```typescript
interface PersonalInfo {
  fullName: string
  title: string
  email: string
  phone: string
  location: string
  linkedin?: string
  website?: string
  summary: string  // 2-3 phrases g√©n√©r√©es par IA
}

interface Experience {
  id: string
  company: string
  position: string
  startDate: string  // "Jan 2022"
  endDate: string     // "D√©c 2023" ou ""
  current: boolean
  description: string
  highlights: string[]  // bullet points
}

interface Education {
  id: string
  institution: string
  degree: string
  field: string
  startDate: string
  endDate: string
  description?: string
}

interface Skill {
  id: string
  name: string
  level: "beginner" | "intermediate" | "advanced" | "expert"
  category: string  // "Frontend", "Backend", "Tools"...
}

interface Language {
  id: string
  name: string
  level: string  // "Natif", "Courant", "Interm√©diaire"
}

interface CVData {
  personalInfo: PersonalInfo
  experiences: Experience[]
  education: Education[]
  skills: Skill[]
  languages: Language[]
}
```

## Mod√®le de r√©ponse (CVJobResponse)

```python
class CVJobResponse(BaseModel):
    job_id: str
    status: str  # "queued" | "running" | "done" | "failed"
    error: Optional[str] = None
    download_url: Optional[str] = None
    created_at: str
```

## Flow MVP
1. User choisit template dans `/templates` ‚Üí redirig√© vers `/generate?template={id}`
2. User submit form (`CVGenerateRequest` = template_id + CVFormData) ‚Üí `POST /api/cv/jobs`
3. API:
   - v√©rifie session
   - v√©rifie que `template_id` existe (sinon 404)
   - v√©rifie quota + rate-limit
   - charge `rules.json` du template et tronque les donn√©es si n√©cessaire
   - cr√©e `cv_jobs(status=queued, templateId=...)`
   - retourne `CVJobResponse { job_id, status, created_at }`
3. Front: √©cran "G√©n√©ration en cours" + polling `GET /api/cv/jobs/:id`
4. Worker:
   - prend un job `queued` ‚Üí `running`
   - appelle OpenAI ‚Üí JSON CV
   - lance Playwright et charge `/internal/cv-render?jobId=...&token=...`
   - g√©n√®re PDF et l‚Äô√©crit dans `PDF_STORAGE_DIR`
   - update job `done` + chemin
   - envoie email "Votre PDF est pr√™t" (Resend) avec lien

## Stockage PDF (MVP)
- Stockage disque local (volume docker) : `PDF_STORAGE_DIR` partag√© entre app & worker
- Lien de download : route s√©curis√©e (`GET /api/cv/jobs/:id/download`) qui stream le fichier

## R√®gles d‚Äôerreur
- Si OpenAI √©choue : job `failed` + message court + possibilit√© de relancer (nouveau job)
- Timeout g√©n√©ration : job `failed` apr√®s X minutes

## Contraintes ARM/Docker
- Pr√©voir image worker qui installe Chromium + deps Playwright sur ARM
- Alternative fallback : Puppeteer + Chromium syst√®me si Playwright image non compatible
